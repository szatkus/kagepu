<!DOCTYPE html>
<!-- saved from url=(0062)https://austineng.github.io/webgpu-samples/hello_triangle.html -->
<html><script type="text/javascript">Object.defineProperty(window.navigator, 'userAgent', { get: function(){ return 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3112.113 Safari/537.36'; } });Object.defineProperty(window.navigator, 'vendor', { get: function(){ return ''; } });Object.defineProperty(window.navigator, 'platform', { get: function(){ return 'Windows'; } });</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=600">
  <title>WebGPU Triangle demo</title>
  <script src="utils.js"></script>
  <script src="/kagepu.js"></script>
  <script>
    kagepu.monkeyPatch();
  </script>
<style>.github-corner>svg{fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0;}.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></head>

<body>
  <div id="not-supported" style="display: block;">WebGPU not supported! Please visit <a href="https://webgpu.io/">webgpu.io</a> to see the current implementation status.</div>
  <canvas height="600" width="600"></canvas>
  <script>
    if (!navigator.gpu) {
      document.getElementById('not-supported').style.display = 'block';
      alert('WebGPU not supported! Please visit webgpu.io to see the current implementation status.');
    }

    const vertexShaderGLSL = `#version 450
      const vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));

      void main() {
          gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);
      }
    `;

    const fragmentShaderGLSL = `#version 450
      layout(location = 0) out vec4 outColor;

      void main() {
          outColor = vec4(1.0, 0.0, 0.0, 1.0);
      }
    `;

    async function init() {
      /* Context, Device, SwapChain */
      const adapter = await navigator.gpu.requestAdapter();
      const device = await adapter.requestDevice({});
      await Utils.ready;

      const canvas = document.querySelector('canvas');

      const context = canvas.getContext('gpupresent');

      const swapChainFormat = "bgra8unorm";

      const swapChain = context.configureSwapChain({
        device,
        format: swapChainFormat,
      });

      const pipeline = device.createRenderPipeline({
        layout: device.createPipelineLayout({ bindGroupLayouts: [] }),

        vertexStage: {
          module: device.createShaderModule({
            code: Utils.compile("v", vertexShaderGLSL),
          }),
          entryPoint: "main",
        },
        fragmentStage: {
          module: device.createShaderModule({
            code: Utils.compile("f", fragmentShaderGLSL),
          }),
          entryPoint: "main"
        },

        primitiveTopology: "triangle-list",

        vertexInput: {
          indexFormat: "uint32",
        },

        rasterizationState: {
          frontFace: 'ccw',
          cullMode: 'none',
        },

        colorStates: [{
          format: swapChainFormat,
          alphaBlend: {},
          colorBlend: {},
        }],
      });

      function frame() {
        const commandEncoder = device.createCommandEncoder({});
        const textureView = swapChain.getCurrentTexture().createDefaultView();

        const renderPassDescriptor = {
          colorAttachments: [{
            loadOp: "clear",
            storeOp: "store",
            clearColor: { r: 0.0, g: 0.0, b: 0.0, a: 1.0 },
            attachment: textureView,
          }],
        };

        const passEncoder = commandEncoder.beginRenderPass(renderPassDescriptor);
        passEncoder.setPipeline(pipeline);
        passEncoder.draw(3, 1, 0, 0);
        passEncoder.endPass();

        device.getQueue().submit([commandEncoder.finish()]);

        requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    init();

  </script>



</body></html>
